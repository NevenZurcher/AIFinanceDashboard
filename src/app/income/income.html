<div class="income-container">
  <header class="income-header glass-card">
    <div class="header-content">
      <h1>Income Streams</h1>

      <button class="btn-primary" (click)="showAddModal = true">
        <lucide-icon [img]="Plus" [size]="18"></lucide-icon>
        Add Income Stream
      </button>
    </div>
  </header>

  <section class="summary-section glass-card">
    <div class="summary-content">
      <lucide-icon [img]="DollarSign" [size]="32" class="summary-icon"></lucide-icon>
      <div>
        <p class="summary-label">Total Monthly Income</p>
        <h2 class="summary-value">${{ getTotalMonthlyIncome().toFixed(2) }}</h2>
      </div>
    </div>
  </section>

  <section class="streams-section">
    <div class="streams-grid">
      <div *ngFor="let stream of incomeStreams" class="stream-card glass-card">
        <div class="stream-header">
          <div class="stream-icon">
            <lucide-icon [img]="Wallet" [size]="24"></lucide-icon>
          </div>
          <div class="stream-info">
            <h3>{{ stream.name }}</h3>
            <p class="text-secondary">{{ stream.accountName }}</p>
          </div>
          <div class="stream-actions">
            <button class="btn-icon-edit" (click)="editStream(stream)">
              <lucide-icon [img]="Edit" [size]="18"></lucide-icon>
            </button>
            <button class="btn-icon-delete" (click)="deleteStream(stream.id)">
              <lucide-icon [img]="Trash2" [size]="18" class="text-error"></lucide-icon>
            </button>
          </div>
        </div>
        <div class="stream-details">
          <div class="detail-item">
            <lucide-icon [img]="DollarSign" [size]="16"></lucide-icon>
            <span>${{ stream.amount.toFixed(2) }}</span>
          </div>
          <div class="detail-item">
            <lucide-icon [img]="Calendar" [size]="16"></lucide-icon>
            <span>{{ stream.frequency | titlecase }}</span>
          </div>
        </div>
        <div class="deposit-info">
          <div class="deposit-item">
            <span class="deposit-label">Last Deposit:</span>
            <span class="deposit-value">{{ formatDate(stream.lastDepositDate) }}</span>
          </div>
          <div class="deposit-item">
            <span class="deposit-label">Next Deposit:</span>
            <span class="deposit-value">{{ formatDate(stream.nextDepositDate) }} ({{ getDaysUntilNextDeposit(stream.nextDepositDate) }} days)</span>
          </div>
        </div>
      </div>

      <div *ngIf="incomeStreams.length === 0" class="empty-state glass-card">
        <lucide-icon [img]="DollarSign" [size]="48" class="empty-icon"></lucide-icon>
        <h3>No Income Streams Yet</h3>
        <p>Add your first income stream to start tracking your earnings</p>
      </div>
    </div>
  </section>

  <!-- Add Income Stream Modal -->
  <div *ngIf="showAddModal" class="modal-overlay" (click)="showAddModal = false">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Add Income Stream</h2>
        <button class="close-btn" (click)="showAddModal = false">×</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Income Source Name</label>
          <input type="text" [(ngModel)]="newStreamName" placeholder="e.g., Salary, Freelance">
        </div>
        <div class="form-group">
          <label>Amount</label>
          <input type="number" [(ngModel)]="newStreamAmount" placeholder="0.00" step="0.01" min="0">
        </div>
        <div class="form-group">
          <label>Frequency</label>
          <select [(ngModel)]="newStreamFrequency">
            <option value="weekly">Weekly</option>
            <option value="bi-weekly">Bi-weekly</option>
            <option value="monthly">Monthly</option>
          </select>
        </div>
        <div class="form-group">
          <label>Deposit Account</label>
          <select [(ngModel)]="newStreamAccountId">
            <option value="">Select an account</option>
            <option *ngFor="let account of accounts" [value]="account.id">{{ account.name }}</option>
          </select>
        </div>
        <div class="modal-actions">
          <button class="btn-secondary" (click)="showAddModal = false">Cancel</button>
          <button class="btn-primary" (click)="addIncomeStream()" [disabled]="isLoading">
            {{ isLoading ? 'Adding...' : 'Add Stream' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Income Stream Modal -->
  <div *ngIf="showEditModal" class="modal-overlay" (click)="showEditModal = false">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Edit Income Stream</h2>
        <button class="close-btn" (click)="showEditModal = false">×</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Income Source Name</label>
          <input type="text" [(ngModel)]="editingStream.name" placeholder="e.g., Salary, Freelance">
        </div>
        <div class="form-group">
          <label>Amount</label>
          <input type="number" [(ngModel)]="editingStream.amount" placeholder="0.00" step="0.01" min="0">
        </div>
        <div class="form-group">
          <label>Frequency</label>
          <select [(ngModel)]="editingStream.frequency">
            <option value="weekly">Weekly</option>
            <option value="bi-weekly">Bi-weekly</option>
            <option value="monthly">Monthly</option>
          </select>
        </div>
        <div class="form-group">
          <label>Deposit Account</label>
          <select [(ngModel)]="editingStream.accountId">
            <option value="">Select an account</option>
            <option *ngFor="let account of accounts" [value]="account.id">{{ account.name }}</option>
          </select>
        </div>
        <div class="modal-actions">
          <button class="btn-secondary" (click)="showEditModal = false">Cancel</button>
          <button class="btn-primary" (click)="saveEditedStream()" [disabled]="isLoading">
            {{ isLoading ? 'Saving...' : 'Save Changes' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

