<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header glass-card animate-fade-in">
    <div class="header-content">
      <div>
        <h1 class="m-0">Financial Dashboard</h1>
        <p class="text-secondary m-0">Welcome back, {{ userName }}!</p>
      </div>
      <div style="display: flex; gap: 1rem; align-items: center;">
        <div class="budget-control" style="display: flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 8px;">
            <span style="font-size: 14px; color: var(--text-secondary);">Budget: $</span>
            <input type="number" [(ngModel)]="monthlyBudget" (change)="calculateSummary(); initTrendChart()" style="width: 70px; background: transparent; border: none; color: var(--text-primary); font-weight: bold; font-size: 16px;">
        </div>
        <button class="btn-primary" (click)="showAddAccountModal = true">
          <lucide-icon [img]="Wallet" [size]="18"></lucide-icon>
          Add Account
        </button>
        <button class="btn-primary" (click)="showAddTransactionModal = true">
          <lucide-icon [img]="ArrowUpRight" [size]="18"></lucide-icon>
          Add Transaction
        </button>
        <button class="btn-secondary" (click)="logout()">
          Sign Out
        </button>
      </div>
    </div>
  </header>

  <!-- Summary Cards -->
  <section class="summary-section animate-slide-up">
    <div class="summary-grid">
      <!-- Total Balance Card -->
      <div class="summary-card glass-card">
        <div class="card-icon" style="background: linear-gradient(135deg, #0891B2, #06B6D4);">
          <lucide-icon [img]="TrendingUp" [size]="28" [strokeWidth]="2"></lucide-icon>
        </div>
        <div class="card-content">
          <p class="card-label">Total Balance</p>
          <h2 class="card-value">${{ totalBalance.toFixed(2) }}</h2>
          <p class="card-change text-success">
            <span>↑</span> 12.5% from last month
          </p>
        </div>
      </div>

      <!-- Monthly Income Card -->
      <div class="summary-card glass-card">
        <div class="card-icon" style="background: linear-gradient(135deg, #10B981, #34D399);">
          <lucide-icon [img]="ArrowUpRight" [size]="28" [strokeWidth]="2"></lucide-icon>
        </div>
        <div class="card-content">
          <p class="card-label">Monthly Income</p>
          <h2 class="card-value">${{ monthlyIncome.toFixed(2) }}</h2>
          <p class="card-change text-success">
            <span>↑</span> 8.2% from last month
          </p>
        </div>
      </div>

      <!-- Monthly Expenses Card -->
      <div class="summary-card glass-card">
        <div class="card-icon" style="background: linear-gradient(135deg, #F43F5E, #FB7185);">
          <lucide-icon [img]="ArrowDownRight" [size]="28" [strokeWidth]="2"></lucide-icon>
        </div>
        <div class="card-content">
          <p class="card-label">Monthly Expenses</p>
          <h2 class="card-value">${{ monthlyExpenses.toFixed(2) }}</h2>
          <p class="card-change text-error">
            <span>↓</span> 3.1% from last month
          </p>
        </div>
      </div>

      <!-- Remaining Budget Card -->
      <div class="summary-card glass-card">
        <div class="card-icon" style="background: linear-gradient(135deg, #F59E0B, #FBBF24);">
          <lucide-icon [img]="Target" [size]="28" [strokeWidth]="2"></lucide-icon>
        </div>
        <div class="card-content">
          <p class="card-label">Remaining Budget</p>
          <h2 class="card-value" [ngClass]="budgetRemaining < 0 ? 'text-error' : ''">${{ budgetRemaining.toFixed(2) }}</h2>
          <p class="card-change" [ngClass]="budgetUsedPercentage > 90 ? 'text-error' : 'text-success'">
            <span>{{ budgetUsedPercentage.toFixed(1) }}%</span> used
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Charts Section -->
  <section class="charts-section">
    <div class="charts-grid">
      <!-- Spending by Category -->
      <div class="chart-card glass-card animate-slide-up">
        <h3>Spending by Category</h3>
        <div class="chart-container">
          <canvas id="categoryChart"></canvas>
        </div>
      </div>

      <!-- Budget vs Spending Trend -->
      <div class="chart-card glass-card animate-slide-up">
        <h3>Budget vs Spending Trend</h3>
        <div class="chart-container">
          <canvas id="trendChart"></canvas>
        </div>
      </div>
    </div>
  </section>

  <!-- AI Insights & Recent Transactions -->
  <section class="bottom-section">
    <div class="bottom-grid">
      <!-- AI Insights -->
      <div class="insights-card glass-card animate-slide-up">
        <div class="section-header">
          <h3><lucide-icon [img]="Sparkles" [size]="20" [strokeWidth]="2" style="display: inline-block; vertical-align: middle; margin-right: 8px;"></lucide-icon>AI Insights</h3>
          <button class="btn-text">View All</button>
        </div>
        <div class="insights-list">
          <div *ngFor="let insight of aiInsights" 
               class="insight-item"
               [ngClass]="'insight-' + insight.type">
            <div class="insight-icon">
              <lucide-icon 
                [img]="insight.type === 'success' ? CheckCircle : insight.type === 'warning' ? AlertTriangle : Info" 
                [size]="20" 
                [strokeWidth]="2"
              ></lucide-icon>
            </div>
            <div class="insight-content">
              <h4>{{ insight.title }}</h4>
              <p>{{ insight.description }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Transactions -->
      <div class="transactions-card glass-card animate-slide-up">
        <div class="section-header">
          <h3>Recent Transactions</h3>
          <button class="btn-text">View All</button>
        </div>
        <div class="transactions-list">
          <div *ngFor="let transaction of transactions.slice(0, 6)" class="transaction-item">
            <div class="transaction-icon" 
                 [ngClass]="transaction.type === 'income' ? 'icon-income' : 'icon-expense'">
              <lucide-icon 
                [img]="transaction.type === 'income' ? ArrowDown : ArrowUp" 
                [size]="18" 
                [strokeWidth]="2.5"
              ></lucide-icon>
            </div>
            <div class="transaction-details">
              <p class="transaction-description">{{ transaction.description }}</p>
              <p class="transaction-category">{{ transaction.category }} • {{ transaction.date | date: 'MMM d' }}</p>
            </div>
            <div class="transaction-amount" 
                 [ngClass]="transaction.type === 'income' ? 'text-success' : 'text-error'">
              {{ transaction.amount > 0 ? '+' : '' }}${{ transaction.amount.toFixed(2) }}
            </div>
            <button class="btn-icon" (click)="deleteTransaction(transaction.id)" [disabled]="isLoading" style="margin-left: 10px; background: none; border: none; cursor: pointer;">
              <lucide-icon [img]="Trash2" [size]="18" class="text-error"></lucide-icon>
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Accounts Overview -->
  <section class="accounts-section animate-slide-up">
    <div class="section-header">
      <h3>Your Accounts</h3>
      <button class="btn-secondary">+ Add Account</button>
    </div>
    <div class="accounts-grid">
      <div *ngFor="let account of accounts" class="account-card glass-card">
        <div class="account-header">
          <div class="account-icon">
            <lucide-icon 
              [img]="account.type === 'checking' ? Building2 : account.type === 'savings' ? Wallet : CreditCard" 
              [size]="24" 
              [strokeWidth]="2"
            ></lucide-icon>
            <button class="btn-icon" (click)="deleteAccount(account.id)" [disabled]="isLoading" style="position: absolute; top: 15px; right: 15px; background: none; border: none; cursor: pointer;">
                <lucide-icon [img]="Trash2" [size]="16" class="text-error" color="rgba(255, 99, 71, 0.6)"></lucide-icon>
            </button>
          </div>
          <div class="account-info">
            <h4>{{ account.name }}</h4>
            <p class="text-secondary">{{ account.type | titlecase }}</p>
          </div>
        </div>
        <div class="account-balance">
          <p class="balance-label">Current Balance</p>
          <h3 [ngClass]="account.balance < 0 ? 'text-error' : 'text-primary'">
            ${{ account.balance.toFixed(2) }}
          </h3>
        </div>
      </div>
    </div>
  </section>

  <!-- Add Account Modal -->
  <div *ngIf="showAddAccountModal" class="modal-overlay" (click)="showAddAccountModal = false">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Add New Account</h2>
        <button class="close-btn" (click)="showAddAccountModal = false">×</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Account Name</label>
          <input type="text" [(ngModel)]="newAccountName" placeholder="e.g., Checking Account">
        </div>
        <div class="form-group">
          <label>Account Type</label>
          <select [(ngModel)]="newAccountType">
            <option value="checking">Checking</option>
            <option value="savings">Savings</option>
            <option value="credit">Credit Card</option>
            <option value="roth">Roth IRA</option>
          </select>
        </div>
        <div class="form-group">
          <label>Initial Balance</label>
          <input type="number" [(ngModel)]="newAccountBalance" placeholder="0.00" step="0.01">
        </div>
        <div class="modal-actions">
          <button class="btn-secondary" (click)="showAddAccountModal = false">Cancel</button>
          <button class="btn-primary" (click)="createAccount()" [disabled]="isLoading">
            {{ isLoading ? 'Creating...' : 'Create Account' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Transaction Modal -->
  <div *ngIf="showAddTransactionModal" class="modal-overlay" (click)="showAddTransactionModal = false">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Add Transaction</h2>
        <button class="close-btn" (click)="showAddTransactionModal = false">×</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Account</label>
          <select [(ngModel)]="newTransactionAccountId">
            <option value="">Select an account</option>
            <option *ngFor="let account of accounts" [value]="account.id">{{ account.name }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Type</label>
          <select [(ngModel)]="newTransactionType">
            <option value="income">Income</option>
            <option value="expense">Expense</option>
          </select>
        </div>
        <div class="form-group">
          <label>Amount</label>
          <input type="number" [(ngModel)]="newTransactionAmount" placeholder="0.00" step="0.01">
        </div>
        <div class="form-group">
          <label>Category</label>
          <input type="text" [(ngModel)]="newTransactionCategory" placeholder="e.g., Food, Salary">
        </div>
        <div class="form-group">
          <label>Description</label>
          <input type="text" [(ngModel)]="newTransactionDescription" placeholder="Optional">
        </div>
        <div class="form-group">
          <label>Date</label>
          <input type="date" [(ngModel)]="newTransactionDate">
        </div>
        <div class="modal-actions">
          <button class="btn-secondary" (click)="showAddTransactionModal = false">Cancel</button>
          <button class="btn-primary" (click)="createTransaction()" [disabled]="isLoading">
            {{ isLoading ? 'Adding...' : 'Add Transaction' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
